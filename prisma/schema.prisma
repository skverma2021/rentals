generator client {
  provider = "prisma-client"
  output   = "../src/generated/client"
}

datasource db {
  provider = "sqlite"
}

// ============================================
// AUTHENTICATION & MULTI-TENANCY MODELS
// ============================================

model agencies {
  id            Int       @id @default(autoincrement())
  name          String    @unique
  contactEmail  String    @unique
  contactPhone  String?
  address       String?
  city          String?
  stateProvince String?
  zipPostalCode String?
  countryRegion String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations - Agency owns all data
  authUsers        authUsers[]
  assets           assets[]
  customers        customers[]
  assetCategory    assetCategory[]
  manufacturer     manufacturer[]
  assetSpec        assetSpec[]
  definedCondition definedCondition[]
}

model authUsers {
  id            Int      @id @default(autoincrement())
  agencyId      Int
  agency        agencies @relation(fields: [agencyId], references: [id])

  // User Profile
  firstName     String
  lastName      String
  email         String   @unique
  address       String?
  city          String?
  stateProvince String?
  zipPostalCode String?
  countryRegion String?

  // OAuth Provider Info
  provider   String  // "github" | "google"
  providerId String  // OAuth provider's user ID
  avatarUrl  String?

  // Access Control
  role        String   @default("user") // "admin" | "manager" | "user"
  isActive    Boolean  @default(true)
  lastLoginAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerId])
  @@index([agencyId])
}

// ============================================
// MODIFIED EXISTING MODELS (with agencyId)
// ============================================

model assets {
  id                    Int                     @id @default(autoincrement())
  agencyId              Int
  agency                agencies                @relation(fields: [agencyId], references: [id])
  specId                Int
  acquiredDate          DateTime
  purchasePrice         Float
  attachments           assetFile[]
  createdAt             DateTime                @default(now())
  assetSpec             assetSpec               @relation(fields: [specId], references: [id])
  assetCurrentCondition assetCurrentCondition[]
  assetCurrentValue     assetCurrentValue[]
  assetWithCustomer     assetWithCustomer[]

  @@index([agencyId])
}

model assetCategory {
  id          Int         @id @default(autoincrement())
  agencyId    Int
  agency      agencies    @relation(fields: [agencyId], references: [id])
  description String
  assetSpec   assetSpec[]

  @@unique([agencyId, description])
  @@index([agencyId])
}

model manufacturer {
  id          Int         @id @default(autoincrement())
  agencyId    Int
  agency      agencies    @relation(fields: [agencyId], references: [id])
  description String
  assetSpec   assetSpec[]

  @@unique([agencyId, description])
  @@index([agencyId])
}

model assetSpec {
  id              Int           @id @default(autoincrement())
  agencyId        Int
  agency          agencies      @relation(fields: [agencyId], references: [id])
  assetCategoryId Int
  manufacturerId  Int
  yearMake        Int
  model           String
  description     String
  assetCategory   assetCategory @relation(fields: [assetCategoryId], references: [id])
  manufacturer    manufacturer  @relation(fields: [manufacturerId], references: [id])
  assets          assets[]

  @@index([agencyId])
}

model definedCondition {
  id                    Int                     @id @default(autoincrement())
  agencyId              Int
  agency                agencies                @relation(fields: [agencyId], references: [id])
  description           String
  assetCurrentCondition assetCurrentCondition[]

  @@unique([agencyId, description])
  @@index([agencyId])
}

// ============================================
// UNCHANGED STRUCTURE (inherit agency via parent)
// ============================================

model assetCurrentCondition {
  id                 Int              @id @default(autoincrement())
  assetId            Int
  definedConditionId Int
  asOnDate           DateTime
  assets             assets           @relation(fields: [assetId], references: [id])
  definedCondition   definedCondition @relation(fields: [definedConditionId], references: [id])
}

model assetCurrentValue {
  id              Int      @id @default(autoincrement())
  assetId         Int
  theCurrentValue Float
  asOnDate        DateTime
  assets          assets   @relation(fields: [assetId], references: [id])
}

model assetWithCustomer {
  id           Int       @id @default(autoincrement())
  assetId      Int
  customerId   Int
  ratePerMonth Float
  fromDate     DateTime
  toDate       DateTime? // null means rental is ongoing (asset not yet returned)
  assets       assets    @relation(fields: [assetId], references: [id])
  customer     customers @relation(fields: [customerId], references: [id])
}

model customers {
  id                Int                 @id @default(autoincrement())
  agencyId          Int
  agency            agencies            @relation(fields: [agencyId], references: [id])
  company           String?
  lastName          String
  firstName         String
  emailId           String
  jobTitle          String?
  businessPhone     String?
  homePhone         String?
  mobilePhone       String
  address           String
  city              String
  stateProvince     String
  zipPostalCode     String
  countryRegion     String
  webPage           String?
  attachments       customerFile[]
  createdAt         DateTime            @default(now())
  assetWithCustomer assetWithCustomer[]

  @@unique([agencyId, emailId])
  @@unique([agencyId, mobilePhone])
  @@index([agencyId])
}

model customerFile {
  id         String    @id @default(cuid())
  customerId Int
  customer   customers @relation(fields: [customerId], references: [id])
  fileName   String
  fileType   String
  fileSize   Int
  fileUrl    String
  createdAt  DateTime  @default(now())
}

model assetFile {
  id        String   @id @default(cuid())
  assetId   Int
  asset     assets   @relation(fields: [assetId], references: [id])
  fileName  String
  fileType  String
  fileSize  Int
  fileUrl   String
  createdAt DateTime @default(now())
}
